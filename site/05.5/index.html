<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>5.5 使用Beego orm库进行ORM开发 - My Docs</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "5.5 \u4f7f\u7528Beego orm\u5e93\u8fdb\u884cORM\u5f00\u53d1";
    var mkdocs_page_input_path = "05.5.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> My Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">0.0目录</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../01.0/">1.0 GO环境配置</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../01.1/">1.1安装 Go</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../01.2/">1.2 GOPATH与工作空间</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../01.3/">1.3 Go 命令</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../01.4/">1.4 Go开发工具</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../01.5/">1.5 总结</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../02.0/">2 Go语言基础</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../02.1/">2.1 你好，Go</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../02.2/">2.2 Go基础</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../02.3/">2.3 流程和函数</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../02.4/">2.4 struct类型</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../02.5/">2.5 面向对象</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../02.6/">2.6 interface</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../02.7/">2.7 并发</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../02.8/">2.8 总结</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../03.0/">3 Web基础</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../03.1/">3.1 Web工作方式</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../03.2/">3.2 Go搭建一个Web服务器</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../03.3/">3.3 Go如何使得Web工作</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../03.4/">3.4 Go的http包详解</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../03.5/">3.5 小结</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../04.0/">4 表单</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../04.1/">4.1 处理表单的输入</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../04.2/">4.2 验证表单的输入</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../04.3/">4.3 预防跨站脚本</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../04.4/">4.4 防止多次递交表单</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../04.5/">4.5 处理文件上传</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../04.6/">4.6 小结</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../05.0/">5 访问数据库</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../05.1/">5.1 database/sql接口</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../05.2/">5.2 使用MySQL数据库</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../05.3/">5.3 使用SQLite数据库</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../05.4/">5.4 使用PostgreSQL数据库</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">5.5 使用Beego orm库进行ORM开发</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#55-beego-ormorm">5.5 使用Beego orm库进行ORM开发</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#_1">安装</a></li>
        
            <li><a class="toctree-l3" href="#_2">如何初始化</a></li>
        
            <li><a class="toctree-l3" href="#_3">插入数据</a></li>
        
            <li><a class="toctree-l3" href="#_4">更新数据</a></li>
        
            <li><a class="toctree-l3" href="#_5">查询数据</a></li>
        
            <li><a class="toctree-l3" href="#_6">删除数据</a></li>
        
            <li><a class="toctree-l3" href="#_7">关联查询</a></li>
        
            <li><a class="toctree-l3" href="#group-byhaving">Group By和Having</a></li>
        
            <li><a class="toctree-l3" href="#sql">使用原生sql</a></li>
        
            <li><a class="toctree-l3" href="#_8">进一步的发展</a></li>
        
            <li><a class="toctree-l3" href="#links">links</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../05.6/">5.6 NOSQL数据库操作</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../05.7/">5.7 小结</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../06.0/">6 session和数据存储</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../06.1/">6.1 session和cookie</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../06.2/">6.2 Go如何使用session</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../06.3/">6.3 session存储</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../06.4/">6.4 预防session劫持</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../06.5/">6.5 小结</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../07.0/">7 文本处理</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../07.1/">7.1 XML处理</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../07.2/">7.2 JSON处理</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../07.3/">7.3 正则处理</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../07.4/">7.4 模板处理</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../07.5/">7.5 文件操作</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../07.6/">7.6 字符串处理</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../07.7/">7.7 小结</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../08.0/">8 Web服务</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../08.1/">8.1 Socket编程</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../08.2/">8.2 WebSocket</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../08.3/">8.3 REST</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../08.4/">8.4 RPC</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../08.5/">8.5 小结</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../09.0/">9 安全与加密</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../09.1/">9.1 预防CSRF攻击</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../09.2/">9.2 确保输入过滤</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../09.3/">9.3 避免XSS攻击</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../09.4/">9.4 避免SQL注入</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../09.5/">9.5 存储密码</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../09.6/">9.6 加密和解密数据</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../09.7/">9.7 小结</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../10.0/">10 国际化和本地化</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../10.1/">10.1 设置默认地区</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../10.2/">10.2 本地化资源</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../10.3/">10.3 国际化站点</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../10.4/">10.4 小结</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../11.0/">11 错误处理，调试和测试</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../11.1/">11.1 错误处理</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../11.2/">11.2 使用GDB调试</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../11.3/">11.3 Go怎么写测试用例</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../11.4/">11.4 小结</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../12.0/">12 部署与维护</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../12.1/">12.1 应用日志</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../12.2/">12.2 网站错误处理</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../12.3/">12.3 应用部署</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../12.4/">12.4 备份和恢复</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../12.5/">12.5 小结</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../13.0/">13 如何设计一个Web框架</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../13.1/">13.1 项目规划</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../13.2/">13.2 自定义路由器设计</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../13.3/">13.3 controller设计</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../13.4/">13.4 日志和配置设计</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../13.5/">13.5 实现博客的增删改</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../13.6/">13.6 小结</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../14.0/">14 扩展Web框架</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../14.1/">14.1 静态文件支持</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../14.2/">14.2 Session支持</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../14.3/">14.3 表单及验证支持</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../14.4/">14.4 用户认证</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../14.5/">14.5 多语言支持</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../14.6/">14.6 pprof支持</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../14.7/">14.7 小结</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../preface/">0.0目录</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../ref/">附录A 参考资料</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">My Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>5.5 使用Beego orm库进行ORM开发</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="55-beego-ormorm">5.5 使用Beego orm库进行ORM开发</h1>
<p>beego orm是我开发的一个Go进行ORM操作的库，它采用了Go style方式对数据库进行操作，实现了struct到数据表记录的映射。beego orm是一个十分轻量级的Go ORM框架，开发这个库的本意降低复杂的ORM学习曲线，尽可能在ORM的运行效率和功能之间寻求一个平衡，beego orm是目前开源的Go ORM框架中实现比较完整的一个库，而且运行效率相当不错，功能也基本能满足需求。</p>
<p>beego orm是支持database/sql标准接口的ORM库，所以理论上来说，只要数据库驱动支持database/sql接口就可以无缝的接入beego orm。目前我测试过的驱动包括下面几个：</p>
<p>Mysql: <a href="https://github.com/go-sql-driver/mysql">github/go-mysql-driver/mysql</a></p>
<p>PostgreSQL: <a href="https://github.com/lib/pq">github.com/lib/pq</a></p>
<p>SQLite: <a href="https://github.com/mattn/go-sqlite3">github.com/mattn/go-sqlite3</a></p>
<p>Mysql: <a href="https://github.com/ziutek/mymysql">github.com/ziutek/mymysql/godrv</a></p>
<p>暂未支持数据库:</p>
<p>MsSql: <a href="https://github.com/denisenkom/go-mssqldb">github.com/denisenkom/go-mssqldb</a></p>
<p>MS ADODB: <a href="https://github.com/mattn/go-adodb">github.com/mattn/go-adodb</a></p>
<p>Oracle: <a href="https://github.com/mattn/go-oci8">github.com/mattn/go-oci8</a></p>
<p>ODBC: <a href="https://bitbucket.org/miquella/mgodbc">bitbucket.org/miquella/mgodbc</a></p>
<h2 id="_1">安装</h2>
<p>beego orm支持go get方式安装，是完全按照Go Style的方式来实现的。</p>
<pre><code>go get github.com/astaxie/beego
</code></pre>
<h2 id="_2">如何初始化</h2>
<p>首先你需要import相应的数据库驱动包、database/sql标准接口包以及beego orm包，如下所示：</p>
<pre><code class="Go">
import (
    &quot;database/sql&quot;
    &quot;github.com/astaxie/beego/orm&quot;
    _ &quot;github.com/go-sql-driver/mysql&quot;
)

func init() {
    //注册驱动
    orm.RegisterDriver(&quot;mysql&quot;, orm.DR_MySQL)
    //设置默认数据库
    orm.RegisterDataBase(&quot;default&quot;, &quot;mysql&quot;, &quot;root:root@/my_db?charset=utf8&quot;, 30)
    //注册定义的model
        orm.RegisterModel(new(User))

    // 创建table
        orm.RunSyncdb(&quot;default&quot;, false, true)
}
</code></pre>

<p>PostgreSQL 配置:</p>
<pre><code class="Go">//导入驱动
// _ &quot;github.com/lib/pq&quot;

// 注册驱动
orm.RegisterDriver(&quot;postgres&quot;, orm.DR_Postgres) 

// 设置默认数据库
//PostgresQL用户：postgres ，密码：zxxx ， 数据库名称：test ， 数据库别名：default
orm.RegisterDataBase(&quot;default&quot;, &quot;postgres&quot;, &quot;user=postgres password=zxxx dbname=test host=127.0.0.1 port=5432 sslmode=disable&quot;)
</code></pre>

<p>MySQL 配置:</p>
<pre><code class="Go">//导入驱动
//_ &quot;github.com/go-sql-driver/mysql&quot;

//注册驱动
orm.RegisterDriver(&quot;mysql&quot;, orm.DR_MySQL)

// 设置默认数据库
//mysql用户：root ，密码：zxxx ， 数据库名称：test ， 数据库别名：default
 orm.RegisterDataBase(&quot;default&quot;, &quot;mysql&quot;, &quot;root:zxxx@/test?charset=utf8&quot;)
</code></pre>

<p>Sqlite 配置:</p>
<pre><code class="Go">//导入驱动
//_ &quot;github.com/mattn/go-sqlite3&quot;

//注册驱动
orm.RegisterDriver(&quot;sqlite&quot;, orm.DR_Sqlite)

// 设置默认数据库
//数据库存放位置：./datas/test.db ， 数据库别名：default
orm.RegisterDataBase(&quot;default&quot;, &quot;sqlite3&quot;, &quot;./datas/test.db&quot;)
</code></pre>

<p>导入必须的package之后,我们需要打开到数据库的链接，然后创建一个beego orm对象（以MySQL为例)，如下所示
beego orm:</p>
<pre><code class="Go">
func main() {
        o := orm.NewOrm()
}
</code></pre>

<p>简单示例:</p>
<pre><code class="Go">
package main

import (
    &quot;fmt&quot;
    &quot;github.com/astaxie/beego/orm&quot;
    _ &quot;github.com/go-sql-driver/mysql&quot; // 导入数据库驱动
)

// Model Struct
type User struct {
    Id   int
    Name string `orm:&quot;size(100)&quot;`
}

func init() {
    // 设置默认数据库
    orm.RegisterDataBase(&quot;default&quot;, &quot;mysql&quot;, &quot;root:root@/my_db?charset=utf8&quot;, 30)

    // 注册定义的 model
    orm.RegisterModel(new(User))
//RegisterModel 也可以同时注册多个 model
//orm.RegisterModel(new(User), new(Profile), new(Post))

    // 创建 table
    orm.RunSyncdb(&quot;default&quot;, false, true)
}

func main() {
    o := orm.NewOrm()

    user := User{Name: &quot;slene&quot;}

    // 插入表
    id, err := o.Insert(&amp;user)
    fmt.Printf(&quot;ID: %d, ERR: %v\n&quot;, id, err)

    // 更新表
    user.Name = &quot;astaxie&quot;
    num, err := o.Update(&amp;user)
    fmt.Printf(&quot;NUM: %d, ERR: %v\n&quot;, num, err)

    // 读取 one
    u := User{Id: user.Id}
    err = o.Read(&amp;u)
    fmt.Printf(&quot;ERR: %v\n&quot;, err)

    // 删除表
    num, err = o.Delete(&amp;u)
    fmt.Printf(&quot;NUM: %d, ERR: %v\n&quot;, num, err)
}

</code></pre>

<p>SetMaxIdleConns</p>
<p>根据数据库的别名，设置数据库的最大空闲连接</p>
<pre><code class="Go">
orm.SetMaxIdleConns(&quot;default&quot;, 30)
</code></pre>

<p>SetMaxOpenConns</p>
<p>根据数据库的别名，设置数据库的最大数据库连接 (go &gt;= 1.2)</p>
<pre><code class="Go">
orm.SetMaxOpenConns(&quot;default&quot;, 30)
</code></pre>

<p>目前beego orm支持打印调试，你可以通过如下的代码实现调试</p>
<pre><code class="Go">
 orm.Debug = true
</code></pre>

<p>接下来我们的例子采用前面的数据库表User，现在我们建立相应的struct</p>
<pre><code class="Go">
type Userinfo struct {
    Uid     int `PK` //如果表的主键不是id，那么需要加上pk注释，显式的说这个字段是主键
    Username    string
    Departname  string
    Created     time.Time
}

type User struct {
    Uid          int `PK` //如果表的主键不是id，那么需要加上pk注释，显式的说这个字段是主键
    Name        string
    Profile     *Profile   `orm:&quot;rel(one)&quot;` // OneToOne relation
    Post        []*Post `orm:&quot;reverse(many)&quot;` // 设置一对多的反向关系
}

type Profile struct {
    Id          int
    Age         int16
    User        *User   `orm:&quot;reverse(one)&quot;` // 设置一对一反向关系(可选)
}

type Post struct {
    Id    int
    Title string
    User  *User  `orm:&quot;rel(fk)&quot;`
    Tags  []*Tag `orm:&quot;rel(m2m)&quot;`    //设置一对多关系
}

type Tag struct {
    Id    int
    Name  string
    Posts []*Post `orm:&quot;reverse(many)&quot;`
}

func init() {
    // 需要在init中注册定义的model
    orm.RegisterModel(new(Userinfo),new(User), new(Profile), new(Tag))
}


</code></pre>

<blockquote>
<p>注意一点，beego orm针对驼峰命名会自动帮你转化成下划线字段，例如你定义了Struct名字为<code>UserInfo</code>，那么转化成底层实现的时候是<code>user_info</code>，字段命名也遵循该规则。</p>
</blockquote>
<h2 id="_3">插入数据</h2>
<p>下面的代码演示了如何插入一条记录，可以看到我们操作的是struct对象，而不是原生的sql语句，最后通过调用Insert接口将数据保存到数据库。</p>
<pre><code class="Go">
o := orm.NewOrm()
var user User
user.Name = &quot;zxxx&quot;
user.Departname = &quot;zxxx&quot;

id, err := o.Insert(&amp;user)
if err == nil {
    fmt.Println(id)
}
</code></pre>

<p>我们看到插入之后<code>user.Uid</code>就是插入成功之后的自增ID。</p>
<p>同时插入多个对象:InsertMulti</p>
<p>类似sql语句</p>
<pre><code class="Go">
insert into table (name, age) values(&quot;slene&quot;, 28),(&quot;astaxie&quot;, 30),(&quot;unknown&quot;, 20)
</code></pre>

<p>第一个参数 bulk 为并列插入的数量，第二个为对象的slice</p>
<p>返回值为成功插入的数量</p>
<pre><code class="Go">
users := []User{
    {Name: &quot;slene&quot;},
    {Name: &quot;astaxie&quot;},
    {Name: &quot;unknown&quot;},
    ...
}
successNums, err := o.InsertMulti(100, users)
</code></pre>

<p>bulk 为 1 时，将会顺序插入 slice 中的数据</p>
<h2 id="_4">更新数据</h2>
<p>继续上面的例子来演示更新操作，现在user的主键已经有值了，此时调用Insert接口，beego orm内部会自动调用update以进行数据的更新而非插入操作。</p>
<pre><code class="Go">
o := orm.NewOrm()
user := User{Uid: 1}
if o.Read(&amp;user) == nil {
    user.Name = &quot;MyName&quot;
    if num, err := o.Update(&amp;user); err == nil {
        fmt.Println(num)
    }
}
</code></pre>

<p>Update 默认更新所有的字段，可以更新指定的字段：</p>
<pre><code class="Go">
// 只更新 Name
o.Update(&amp;user, &quot;Name&quot;)
// 指定多个字段
// o.Update(&amp;user, &quot;Field1&quot;, &quot;Field2&quot;, ...)
</code></pre>

<p>//Where:用来设置条件，支持多个参数，第一个参数如果为整数，相当于调用了Where("主键=?",值)。</p>
<h2 id="_5">查询数据</h2>
<p>beego orm的查询接口比较灵活，具体使用请看下面的例子</p>
<p>例子1，根据主键获取数据：</p>
<pre><code class="Go">
o := orm.NewOrm()
var user User

user := User{Id: 1}

err = o.Read(&amp;user)

if err == orm.ErrNoRows {
    fmt.Println(&quot;查询不到&quot;)
} else if err == orm.ErrMissPK {
    fmt.Println(&quot;找不到主键&quot;)
} else {
    fmt.Println(user.Id, user.Name)
}
</code></pre>

<p>例子2：</p>
<pre><code class="Go">
o := orm.NewOrm()
var user User

qs := o.QueryTable(user) // 返回 QuerySeter
qs.Filter(&quot;id&quot;, 1) // WHERE id = 1
qs.Filter(&quot;profile__age&quot;, 18) // WHERE profile.age = 18
</code></pre>

<p>例子3，WHERE IN查询条件：</p>
<pre><code class="Go">
qs.Filter(&quot;profile__age__in&quot;, 18, 20) 
// WHERE profile.age IN (18, 20)

</code></pre>

<p>例子4，更加复杂的条件：</p>
<pre><code class="Go">
qs.Filter(&quot;profile__age__in&quot;, 18, 20).Exclude(&quot;profile__lt&quot;, 1000)
// WHERE profile.age IN (18, 20) AND NOT profile_id &lt; 1000

</code></pre>

<p>可以通过如下接口获取多条数据，请看示例</p>
<p>例子1，根据条件age&gt;17，获取20位置开始的10条数据的数据</p>
<pre><code class="Go">
var allusers []User
qs.Filter(&quot;profile__age__gt&quot;, 17)
// WHERE profile.age &gt; 17
</code></pre>

<p>例子2，limit默认从10开始，获取10条数据</p>
<pre><code class="Go">
qs.Limit(10, 20)
// LIMIT 10 OFFSET 20 注意跟SQL反过来的
</code></pre>

<h2 id="_6">删除数据</h2>
<p>beedb提供了丰富的删除数据接口，请看下面的例子</p>
<p>例子1，删除单条数据</p>
<pre><code class="Go">
o := orm.NewOrm()
if num, err := o.Delete(&amp;User{Id: 1}); err == nil {
    fmt.Println(num)
}
</code></pre>

<p>Delete 操作会对反向关系进行操作，此例中 Post 拥有一个到 User 的外键。删除 User 的时候。如果 on_delete 设置为默认的级联操作，将删除对应的 Post</p>
<h2 id="_7">关联查询</h2>
<p>有些应用却需要用到连接查询，所以现在beego orm提供了一个简陋的实现方案：</p>
<pre><code class="Go">
type Post struct {
    Id    int    `orm:&quot;auto&quot;`
    Title string `orm:&quot;size(100)&quot;`
    User  *User  `orm:&quot;rel(fk)&quot;`
}

var posts []*Post
qs := o.QueryTable(&quot;post&quot;)
num, err := qs.Filter(&quot;User__Name&quot;, &quot;slene&quot;).All(&amp;posts)

</code></pre>

<p>上面代码中我们看到了一个struct关联查询</p>
<h2 id="group-byhaving">Group By和Having</h2>
<p>针对有些应用需要用到group by的功能，beego orm也提供了一个简陋的实现</p>
<pre><code class="Go">
qs.OrderBy(&quot;id&quot;, &quot;-profile__age&quot;)
// ORDER BY id ASC, profile.age DESC

qs.OrderBy(&quot;-profile__age&quot;, &quot;profile&quot;)
// ORDER BY profile.age DESC, profile_id ASC

</code></pre>

<p>上面的代码中出现了两个新接口函数</p>
<p>GroupBy:用来指定进行groupby的字段</p>
<p>Having:用来指定having执行的时候的条件</p>
<h2 id="sql">使用原生sql</h2>
<p>简单示例:</p>
<pre><code class="Go">
o := orm.NewOrm()
var r orm.RawSeter
r = o.Raw(&quot;UPDATE user SET name = ? WHERE name = ?&quot;, &quot;testing&quot;, &quot;slene&quot;)
</code></pre>

<p>复杂原生sql使用:</p>
<pre><code class="Go">func (m *User) Query(name string) user []User {
    var o orm.Ormer
    var rs orm.RawSeter
    o = orm.NewOrm()
    rs = o.Raw(&quot;SELECT * FROM user &quot;+
        &quot;WHERE name=? AND uid&gt;10 &quot;+
        &quot;ORDER BY uid DESC &quot;+
        &quot;LIMIT 100&quot;, name)
    //var user []User
    num, err := rs.QueryRows(&amp;user)
    if err != nil {
        fmt.Println(err)
    } else {
        fmt.Println(num)
        //return user
    }
    return
}   
</code></pre>

<p>更多说明,请到<a href="https://beego.me">beego.me</a></p>
<h2 id="_8">进一步的发展</h2>
<p>目前beego orm已经获得了很多来自国内外用户的反馈，我目前也正在考虑支持更多数据库，接下来会在更多方面进行改进</p>
<h2 id="links">links</h2>
<ul>
<li><a href="../preface/">目录</a></li>
<li>上一节: <a href="../05.4/">使用PostgreSQL数据库</a></li>
<li>下一节: <a href="../05.6/">NOSQL数据库操作</a></li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../05.6/" class="btn btn-neutral float-right" title="5.6 NOSQL数据库操作">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../05.4/" class="btn btn-neutral" title="5.4 使用PostgreSQL数据库"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../05.4/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../05.6/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
